# title

この資料では、TypeScript, React, Next.js を中心にそれぞれの役割を解説し、これらの技術が Node.js とどのように関わりあっているかについても詳しく解説していきます。

また、これらの技術を開発環境に導入した際に、どのような効果が得られるのかについても触れたいと思います。

## はじめに

まずはじめにこれらの技術の基盤となる Node.js について解説したいと思います。

## Node.js とは

Node.js とはサーバーサイドで JavaScript を実行するための実行環境です。  
Google Chrome 等のブラウザには Google が開発した V8 という JavaScript エンジンが標準搭載されており、これによりブラウザ上で JavaScript が実行可能となっています。  
この V8 をベースにサーバーサイドで実行できるように拡張を行ったのが Node.js です。

### Node.js が開発された目的

従来の Web 開発において、フロントエンドでは JavaScript を、サーバーサイドでは C#、Python、Java などの他のプログラミング言語を使用することが一般的でした。  
しかし、フロントエンドとサーバーサイドで言語が分かれる事により、それぞれで学習コストが発生します。  
これを解決するために Node.js が開発されました。

### フロントエンド開発環境における Node.js の役割

Node.js はその開発目的からも分かる通り、JavaScript をサーバーサイドで実行出来るようにするための技術で、フロントエンドとは関わりの無い技術に思われるかも知れません。

しかし、実際には Node.js は現代のフロントエンド開発において無くてはならない重要な技術となっています。  
その理由は、Node.js が提供する強力なパッケージマネージャー (npm) と、コードの再利用を容易にするモジュールシステムにより、多くのフロントエンド開発ツールが利用可能になっているためです。

開発者は npm を通して、フロントエンド開発を効率化し、より手軽にするための多様なツールを簡単にプロジェクトに組み込むことができます。  
その結果、Node.js を中心に、フロントエンド開発を支援する豊富なツールやライブラリのエコシステムが築かれています。  
これから説明する TypeScript, React, Next.js もそのうちの 1 つです。

## TypeScript とは

TypeScript とは、JavaScript を拡張し、型などの追加の機能を持たせた静的型付け言語です。  
Microsoft 社によりオープンソースで開発が進められています。

また TypeScript は JavaScript の完全なスーパーセットであり、JavaScript の構文は全てサポートされています。  
そのため、JavaScript で書かれたコードは TypeScript でも同様に実行可能です。  
これにより TypeScript を途中からプロジェクトに導入した場合でも、既存の JavaScript のコードに影響を与えること無く型安全に開発を行うことができます。

### TypeScript と Node.js の関係性

現状、TypeScript はブラウザで直接実行することができません。  
この理由は、Google Chrome やその他のブラウザに搭載されている V8 JavaScript エンジンが TypeScript の構文を直接解釈できないためです。  
また、TypeScript はあくまでも JavaScript にトランスパイルされることを前提として開発された言語であり、ブラウザで実行される前に JavaScript に変換しておく必要があります。

そのためのコンパイラを Node.js の npm を通じてインストールして使用することが出来ます。  
→ TypeScript コンパイラ (tsc)

### TypeScript を導入した場合のメリット

TypeScript を導入した場合に得られるメリットは主に以下の 2 つです。

1. コード品質の向上  
   型の機能により、変数への想定外の代入を未然に防ぎ、全体のコード品質を向上させます。  
   型の不一致や予期せぬ型の使用をコンパイル時に検出できるため、バグのリスクを減らせます。
2. 開発効率の向上  
   静的型付け言語であるため、IDE によるコード補完が強化され、開発効率が向上します。

ここでは 1. の型の機能をメインに紹介させていただきます。
例として、以下のような引数同士を足して結果を返すだけの単純な関数の場合を考えます。

```js
// JavaScript の場合
function addNumbers(a, b) {
  return a + b;
}
```

呼び出しは以下のようになります。  
JavaScript の場合は数値を渡すところを誤って文字列を渡してしまった場合もエラーにはなりません。

```js
// JavaScript の場合
console.log(addNumbers(5, 10)); // 15
console.log(addNumbers(5, "10")); // "510"
```

上記の例ように単純に計算を行うだけであれば結果がおかしいという事ですぐ気付けると思いますが、  
以下のように数値によって区分を行う等の処理が挟まっていた場合、更に不具合に気づきづらくなります。

```js
// JavaScript の場合
const result = addNumbers(5, "10"); // "510"
let section;
if (result > 500) {
  section = "A";
} else {
  section = "B";
}

console.log(section); // "A"
```

TypeScript を導入することでこれらの不具合を未然に防ぐことが出来ます。  
同様の例を考えます。TypeScript では他の静的型付け言語と同様に各引数と返り値に型を指定することが出来ます。

```ts
// TypeScript の場合
function addNumbers(a: number, b: number): number {
  return a + b;
}
```

呼び出しは以下のようになります。  
コンパイルエラーにより実行前に不具合に気づく事ができます。

```ts
// TypeScript の場合
console.log(addNumbers(5, 10)); // 15
console.log(addNumbers(5, "10")); // コンパイルエラー (引数はnumber型と指定されているため)
```

これはほんの一例に過ぎませんが、TypeScript を導入することにより JavaScript の動的型付けが故の様々な不具合を未然に防ぐことが出来ます。

また、TypeScript は型を指定しない場合、自動で型推論を行います。  
これにより、導入するだけでも一定の効果が得られます。  
例えば JavaScript ではエラーにならない以下の様なケースを防ぐことが出来ます。

```ts
let a = 100; // number 型と推論される
a = "200"; // コンパイルエラー (number型にstring型を代入しようとしているため)
```

### TypeScript を導入した場合のデメリット

1. 記述量が増える  
   JavaScript に型情報を追記するため、記述量は増えます。
   ただし、導入により開発効率も向上するため、デメリットにはなり得ないかもしれません。
2. 学習コストがかかる
   他の静的型付け言語にはない、TypeScript 独自の型なども存在するため、少なからず学習コストはかかります。
3. ビルドプロセスが必要な分、環境が少し複雑化する
   TypeScript に限った話ではありませんが、新しい技術を導入するとそれに伴い環境は複雑化していきます。

### TypeScript についてのまとめ

TypeScript の導入は、型安全性と開発効率の向上という点で多大なメリットを提供します。  
初期の学習コストや設定の複雑さはあるものの、これらは時間と共に相対的に小さな問題となり、コードの品質とメンテナンス性の向上に対する投資として見ることができます。  
JavaScript に基づくプロジェクトにおいて、TypeScript を導入することにで、信頼性の高いアプリケーションの開発を行うことが出来ると感じました。

## React について

React は UI を構築するためのオープンソースの JavaScript ライブラリです。  
Meta (旧 Facebook) によって開発・保守がされています。

React は見た目の構築に重きをおいて開発されたライブラリです。  
これは React 自身がアプリケーションのデータ処理、ルーティング、DB アクセスといったサーバーサイド処理等に直接関与しないという意味でもあります。  
そのため、ルーティングや DB アクセス等も含めた包括的な開発環境を構築するには後述する Next.js 等のフレームワークを利用することが公式で推奨されています。

次に React と Node.js の関係性について説明させていただきたいと思いますが、  
その前に JavaScript の拡張構文である JSX について先に説明させていただきます。

### JSX とは

JSX とは Meta (旧 Facebook) によって開発された JavaScript の拡張構文です。  
主に React で使用する目的で開発された構文ですが、Vue.js や他のライブラリ・フレームワークでも利用可能です。  
JSX で書くことにより開発者はより直感的な UI の構築が可能になり、またコードの可読性も向上します。

React で以下のような簡単なフォームを JSX 有、無、それぞれで実装した場合の例を表します。

![サンプル](./img/sample.png)

JSX 有

```jsx
return (
  <div>
    <div>
      <span>名前</span>
      <input type="text" />
    </div>
    <button>送信</button>
  </div>
);
```

JSX 無

```jsx
return React.createElement(
  "div",
  null,
  React.createElement(
    "div",
    null,
    React.createElement("span", null, "名前"),
    React.createElement("input", { type: "text" })
  ),
  React.createElement("button", null, "送信")
);
```

JSX を使用すると、直感的で読みやすいコードになることが分かります。  
ただ、JSX を使用して書かれたコードはブラウザで直接実行することができません。  
これは Google Chrome 等のブラウザに搭載されている V8 JavaScript エンジンが JSX 構文を直接解釈出来ないためです。  
そのため、実行前にトランスパイルを行う必要があります。  
このトランスパイルにより JSX は全て JSX 無の構文 (React.createElement) に変換されます。

### React と Node.js の関係性

JSX については先述させていただきましたが、React についてもトランスパイルが必要になります。  
その理由は、React の開発に ES6 (ECMAScript 2015) やそれ以降のバージョン (まとめて ES6+ と呼びます) の JavaScript の機能が幅広く使用されているためです。  
全てのブラウザが ES6+ の機能を全てサポートしている訳では無いので、ES6+ で書かれたコードを ES5 互換のコードにトランスパイルする必要があります。  
そのトランスパイルを行うツールとして Babel 等の JavaScript コンパイラーが存在し、これらを npm を介してインストール、使用することができます。

### React の特徴

React の主な特徴として宣言的な View とコンポーネントベースの 2 つがあります。

#### 宣言的な View

宣言的な View とは、
言葉だけだといまいちイメージがつきづらいと思いますので以下の 2 つの例を見て、実際に表示される画面出力をイメージしてみてください。

これが `React` の特徴の一つである宣言的 UI の概念です。

#### コンポーネントベース

コンポーネントベースとは、あるページを構成する要素を、独立した再利用可能な部品（コンポーネント）に分割し、それぞれが独自の構造、データ、振る舞いを持つという設計思想です。

例えば、ユーザー登録画面とログイン画面を作成する場合、以下のようなコンポーネントを作成します。

> コンポーネントの名前: UserInfoInputForm  
> 引数:
>
> > buttonLabel: ボタンのラベル  
> > buttonOnClick: ボタン押下時の処理
>
> ![サンプル2](./img/sample2.png)

このようなコンポーネントを作成しておくことで、各画面で共通でこのコンポーネントを使用して画面の実装が行なえます。  
以下、各画面の実装例です。

ユーザー登録画面

```jsx
// ユーザー登録用の関数
function register (id, pass) { /* 処理 */ }

return <UserInfoInputForm buttonLabel={"登録"} buttonOnClick={register}>
```

ログイン画面

```jsx
// ログイン用の関数
function login (id, pass) { /* 処理 */ }

return <UserInfoInputForm buttonLabel={"ログイン"} buttonOnClick={login}>
```

このように共通のコンポーネントを使用することで、開発効率の向上、コード量の削減、UI/UX の統一化、保守性の向上等さまざまな恩恵があります。  
これが React の根底にあるコンポーネントベースの思想になります。

### React を導入した場合のメリット

React を導入した場合のメリットは主に以下の 3 つです。

1. 開発効率の向上  
   共通で利用できる汎用的なコンポーネントを開発していくことで、全体の記述量を大幅に減らせるため、開発効率の向上に繋がります。
2. 保守性の向上  
   共通のコンポーネントを利用することで、何か修正が必要な場合に、その修正箇所をコンポーネントの実装部の一箇所に絞ることができるため、保守性の向上に繋がります。
3. UI/UX の統一化  
   共通のコンポーネントを利用するため、全体的に見た目の統一化が行なえます。
4. 作業分担がしやすくなる
   現在の開発体制では画面ごとに作業の分担を行うことが多いですが、コンポーネント単位で分担が行えるため、作業分担が容易になります。
5. テストが容易になる
   各コンポーネント同士が疎結合であるように実装を行うことで、ユニットテストの実装がしやすくなり、アプリケーションの信頼性の向上に繋がります。
6. 仮想 DOM によるパフォーマンスの向上
   React では画面の更新を行う際に、内部で保持している変更前後の仮想 DOM から差分を算出し、、必要最低限の分だけ実際の DOM の更新を行います。  
   従来の DOM やフレームワークで構築された DOM に比べて処理のスピードが速く、Web ページの表示を高速で切り替えることができます。

### React を導入した場合のデメリット

React を導入した場合のデメリットは主に以下の 3 つです。

1. 学習コストがかかる  
   JSX や React 独自のライフサイクル、また状態管理の方法など、堅牢で効率的なアプリケーションを構築するためにはこれらに対する深い理解が求められます。 これにはそれなりの学習コストがかかります。
2. ビルドプロセスが必要な分、環境が少し複雑化する  
   TypeScript と被る内容ではありますが、ビルドプロセスが必要になる分、環境は少し複雑化します。
3. JavaScript の記述量が増える  
   従来 HTML や CSS に記述していた内容を JavaScript に全て記述することになります。  
   そのため、JavaScript の重量が増します。  
   これはデメリットというよりは副作用に近い部分ではあります。

### React についてのまとめ
